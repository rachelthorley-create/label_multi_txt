<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Label Generator (JSON Export)</title>
<style>
  body { font-family: Arial, sans-serif; margin:20px; display:flex; flex-direction:column; align-items:center; }
  h2 { margin-bottom:10px; }
  form { width:100%; max-width:800px; margin-bottom:20px; }
  label { display:block; margin-bottom:6px; }
  input[type="text"], input[type="number"] { width:100%; padding:4px; }
  .slider-container { margin:8px 0; }
  .advanced { display:none; border:1px solid #ccc; padding:10px; margin-top:10px; border-radius:8px; }
  button { padding:6px 12px; }
  .button-row { display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }
  canvas { border:1px solid #ccc; border-radius:8px; }
  #allPreviews { display:flex; flex-direction:column; gap:38px; margin-top:20px; } /* ~10mm spacing */
</style>
</head>
<body>

<h2>Label Generator</h2>
<p>Enter text for each line. All fields are optional. Adjust settings as needed, then click <b>Preview Label(s)</b> to view and export.</p>

<form id="labelForm">
  <h3>Label 1 (Primary Label - this is used to design the layout of your labels. I suggest you use the one where you want the most text for this)</h3>
  <label>Line 1: <input id="line1" type="text" value="1st line"></label>
  <label>Line 2: <input id="line2" type="text" value="2nd line"></label>
  <label>Line 3: <input id="line3" type="text" value="3rd line"></label>

  <div class="button-row">
    <button type="button" id="previewBtn">Preview Label(s)</button>
    <button type="button" id="downloadBtn">Download Layout Instructions (JSON)</button>
    <button type="button" id="toggleAdvanced">Show Advanced Options</button>
  </div>

  <div class="advanced" id="advancedOptions">
    <div class="slider-container">
      <label>Large text size (line 1): <span id="largeSizeLabel">54</span>
      <input id="largeSize" type="range" min="20" max="100" value="54"></label>
    </div>
    <div class="slider-container">
      <label>Small text size (line 2): <span id="smallSizeLabel">27</span>
      <input id="smallSize" type="range" min="10" max="60" value="27"></label>
    </div>

    <div class="slider-container">
      <label>Line 3 text size: <span id="line3SizeLabel">27</span>
      <input id="line3Size" type="range" min="10" max="60" value="27"></label>
      <label><input type="checkbox" id="link23" checked> Same as line 2 size</label>
    </div>

    <div class="slider-container">
      <label>Spacing line1竊値ine2: <span id="gap12Label">4</span>
      <input id="gap12" type="range" min="0" max="20" value="4"></label>
      <label>Spacing line2竊値ine3: <span id="gap23Label">3</span>
      <input id="gap23" type="range" min="0" max="20" value="3"></label>
      <label><input type="checkbox" id="linkGaps"> line2竊値ine3 same as line1竊値ine2</label>
    </div>

    <div class="slider-container">
      <label>Shift all text up/down: <span id="textShiftLabel">0</span>
      <input id="textShift" type="range" min="-20" max="20" value="0"></label>
    </div>

    <div class="slider-container">
      <label>Line 1 font:
        <select id="font1"><option selected>Arial</option><option>Verdana</option><option>Courier New</option></select>
      </label>
      <label><input type="checkbox" id="bold1" checked> Bold</label>
      <label><input type="checkbox" id="italic1"> Italic</label>
    </div>
    <div class="slider-container">
      <label>Line 2 font:
        <select id="font2"><option selected>Arial</option><option>Verdana</option><option>Courier New</option></select>
      </label>
      <label><input type="checkbox" id="bold2"> Bold</label>
      <label><input type="checkbox" id="italic2" checked> Italic</label>
    </div>
    <div class="slider-container">
      <label>Line 3 font:
        <select id="font3"><option selected>Arial</option><option>Verdana</option><option>Courier New</option></select>
      </label>
      <label><input type="checkbox" id="bold3"> Bold</label>
      <label><input type="checkbox" id="italic3"> Italic</label>
    </div>
  </div>
</form>

<h3>Multiple Labels</h3>
<label>Total labels: <input id="numLabels" type="number" min="1" value="1"></label>
<div id="labelsContainer"></div>

<div id="allPreviews"></div>

<script>
const mmToPx = mm => mm * 3.78;

// Advanced toggle
document.getElementById('toggleAdvanced').addEventListener('click',()=>{
  const adv=document.getElementById('advancedOptions');
  const btn=document.getElementById('toggleAdvanced');
  adv.style.display = adv.style.display==='none'?'block':'none';
  btn.textContent = adv.style.display==='none'?'Show Advanced Options':'Hide Advanced Options';
});

// Dynamic label fields
function renderLabelInputs(){
  const n=parseInt(document.getElementById('numLabels').value);
  const container=document.getElementById('labelsContainer');
  container.innerHTML='';
  for(let i=2;i<=n;i++){
    const div=document.createElement('div');
    div.innerHTML=`<h4>Label ${i}</h4>
    <label>Line 1: <input class="multi1" type="text" value="1st line"></label>
    <label>Line 2: <input class="multi2" type="text" value="2nd line"></label>
    <label>Line 3: <input class="multi3" type="text" value="3rd line"></label>`;
    container.appendChild(div);
  }
}
document.getElementById('numLabels').addEventListener('change',renderLabelInputs);
renderLabelInputs();

// Draw label
function drawLabel(data){
  const canvas=document.createElement('canvas');
  canvas.width=mmToPx(100);
  canvas.height=mmToPx(75);
  const ctx=canvas.getContext('2d');
  const radius=mmToPx(2);
  const w=canvas.width, h=canvas.height;
  
  // Background
  ctx.fillStyle='black';
  ctx.beginPath();
  ctx.moveTo(radius,0);
  ctx.lineTo(w-radius,0);
  ctx.quadraticCurveTo(w,0,w,radius);
  ctx.lineTo(w,h-radius);
  ctx.quadraticCurveTo(w,h,w-radius,h);
  ctx.lineTo(radius,h);
  ctx.quadraticCurveTo(0,h,0,h-radius);
  ctx.lineTo(0,radius);
  ctx.quadraticCurveTo(0,0,radius,0);
  ctx.fill();

  // White circle
  const circleR=mmToPx(3);
  const circleY=mmToPx(6+3);
  ctx.beginPath();
  ctx.arc(w/2,circleY,circleR,0,Math.PI*2);
  ctx.fillStyle='white';
  ctx.fill();

  // Text block baseline (lowered ~2mm)
  const marginTop=mmToPx(18+data.textShift);
  const spacing12=mmToPx(data.gap12);
  const spacing23=mmToPx(data.gap23);
  const marginSide=mmToPx(6);
  
  let y=marginTop;
  const lines=[data.line1,data.line2,data.line3].filter(l=>l.text);
  lines.forEach((l,i)=>{
    let fontStr='';
    if(l.italic) fontStr+='italic ';
    if(l.bold) fontStr+='bold ';
    fontStr+=`${l.font_size}px ${l.font}`;
    ctx.font=fontStr;
    ctx.textAlign='center';
    ctx.textBaseline='top';
    ctx.fillStyle='white';
    // Fit scaling
    let textWidth = ctx.measureText(l.text).width;
    const maxWidth = w - marginSide*2;
    if(textWidth > maxWidth){
      const scale = maxWidth / textWidth;
      ctx.save();
      ctx.translate(w/2, y);
      ctx.scale(scale, scale);
      ctx.fillText(l.text, 0, 0);
      ctx.restore();
    } else {
      ctx.fillText(l.text, w/2, y);
    }
    y+=l.font_size+(i===0?spacing12:spacing23);
  });
  return canvas;
}

// Collect data
function collectData(){
  const num=parseInt(document.getElementById('numLabels').value);
  const base={
    canvas:{width_mm:100,height_mm:75,corner_radius_mm:2,circle_diameter_mm:6,circle_top_mm:6,margin_side_mm:6,margin_top_mm:18},
    global:{text_shift_mm:parseFloat(textShift.value),gap12_mm:parseFloat(gap12.value),gap23_mm:parseFloat(gap23.value)},
    labels:[]
  };

  const l1={line1:line1.value,line2:line2.value,line3:line3.value};
  base.labels.push({
    name:'Label 1',
    lines:{
      line1:{text:l1.line1,font_family:font1.value,font_size:parseFloat(large.value),bold:bold1.checked,italic:italic1.checked},
      line2:{text:l1.line2,font_family:font2.value,font_size:parseFloat(small.value),bold:bold2.checked,italic:italic2.checked},
      line3:{text:l1.line3,font_family:font3.value,font_size:parseFloat(line3Size.value),bold:bold3.checked,italic:italic3.checked}
    }
  });

  const multi1=document.querySelectorAll('.multi1');
  const multi2=document.querySelectorAll('.multi2');
  const multi3=document.querySelectorAll('.multi3');
  for(let i=0;i<multi1.length;i++){
    base.labels.push({
      name:`Label ${i+2}`,
      lines:{
        line1:{text:multi1[i].value,font_family:font1.value,font_size:parseFloat(large.value),bold:bold1.checked,italic:italic1.checked},
        line2:{text:multi2[i].value,font_family:font2.value,font_size:parseFloat(small.value),bold:bold2.checked,italic:italic2.checked},
        line3:{text:multi3[i].value,font_family:font3.value,font_size:parseFloat(line3Size.value),bold:bold3.checked,italic:italic3.checked}
      }
    });
  }
  return base;
}

// Preview all
function previewAll(){
  const data=collectData();
  const container=document.getElementById('allPreviews');
  container.innerHTML='';
  data.labels.forEach(label=>{
    const lData={
      line1:label.lines.line1,
      line2:label.lines.line2,
      line3:label.lines.line3,
      gap12:data.global.gap12_mm,
      gap23:data.global.gap23_mm,
      textShift:data.global.text_shift_mm
    };
    container.appendChild(drawLabel(lData));
  });
}

// Download JSON
function downloadJSON(){
  const data=collectData();
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'text/plain'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='labels.txt';
  a.click();
}

document.getElementById('previewBtn').addEventListener('click',previewAll);
document.getElementById('downloadBtn').addEventListener('click',downloadJSON);
</script>

</body>
</html>

